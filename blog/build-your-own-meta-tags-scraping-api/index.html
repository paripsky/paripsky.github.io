<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><!-- Open Graph Meta Tags --><meta property="og:title" content="Building a Meta Tags Scraping API in Under 40 Lines of Code"><meta property="og:description" content="A guide on how to built a meta tags scraping API in Deno in under 40 lines of code"><meta property="og:url" content="/blog/build-your-own-meta-tags-scraping-api"><meta property="og:type" content="website"><!-- Twitter Card Meta Tags --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Building a Meta Tags Scraping API in Under 40 Lines of Code"><meta name="twitter:description" content="A guide on how to built a meta tags scraping API in Deno in under 40 lines of code"><meta name="description" content="A guide on how to built a meta tags scraping API in Deno in under 40 lines of code"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.1.5"><title>Building a Meta Tags Scraping API in Under 40 Lines of Code</title><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BScVxmeO.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1YD1ZSVP59"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-1YD1ZSVP59");
    </script><link rel="stylesheet" href="/_astro/build-your-own-meta-tags-scraping-api.C9LnFh1k.css"></head> <body class="bg-slate-950 text-white" style="color-scheme: dark;"> <a href="/" class="flex gap-1 underline items-center p-4"><svg width="1em" height="1em" class="size-4" data-icon="mdi:arrow-back">   <symbol id="ai:mdi:arrow-back" viewBox="0 0 24 24"><path fill="currentColor" d="M20 11v2H8l5.5 5.5l-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5L8 11z"/></symbol><use href="#ai:mdi:arrow-back"></use>  </svg> Back</a> <main class="max-w-2xl my-4 mx-auto px-4"> <h1 class="text-4xl text-white text-pretty">Building a Meta Tags Scraping API in Under 40 Lines of Code</h1> <h5 class="py-4 flex justify-between flex-wrap"> <span> Monday, October 21, 2024 by @paripsky </span> <a class="flex gap-1 underline" href="https://dev.to/paripsky/building-a-meta-tags-scraping-api-in-under-40-lines-of-code-1f57">Read on <svg width="1em" height="1em" class="size-6" data-icon="mdi:dev-to">   <symbol id="ai:mdi:dev-to" viewBox="0 0 24 24"><path fill="currentColor" d="M7.73 11.93c0 1.72-.02 1.83-.23 2.07c-.19.17-.38.23-.76.23l-.51.01l-.03-2.27l-.02-2.27h.52c.35 0 .6.07.77.21c.24.21.26.25.26 2.02M22 7.5v9c0 1.11-.89 2-2 2H4c-1.11 0-2-.89-2-2v-9c0-1.11.89-2 2-2h16c1.11 0 2 .89 2 2M8.93 11.73c-.03-1.84-.05-1.99-.29-2.39c-.4-.68-.85-.84-2.36-.84H5v7h1.21c1.33 0 1.89-.17 2.29-.71c.41-.53.5-.98.43-3.06m4.19-3.23h-1.48c-1.49 0-1.5 0-1.71.28S9.7 9.21 9.7 12v2.96l.27.27c.25.27.31.27 1.71.27h1.44v-1.19l-1.09-.04l-1.1-.03V12.6l.68-.03l.66-.04v-1.19h-1.39V9.7h2.24zm5.88.06c0-.06-.3-.06-.66-.06l-.68.06l-.59 2.35c-.38 1.48-.62 2.27-.67 2.13c-.08-.27-1.14-4.44-1.14-4.49s-.31-.05-.68-.05h-.69l.41 1.55c.2.87.59 2.28.81 3.15c.34 1.35.46 1.65.75 1.94c.2.22.45.36.61.36c.33 0 .76-.34.9-.73C17.5 14.5 19 8.69 19 8.56"/></symbol><use href="#ai:mdi:dev-to"></use>  </svg></a> </h5> <div class="prose max-w-2xl dark:prose-invert
  prose-h1:font-bold prose-h1:text-2xl
  prose-a:text-blue-300 prose-img:rounded-xl
  prose-headings:mt-0 prose-headings:text-white prose-p:text-slate-200 prose-li:text-slate-200 prose-strong:text-white prose-code:text-white prose-code:prose-strong:text-white"> <p>Have you ever wondered how messaging apps like Whatsapp or Telegram let you see a preview of a link that you send?</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hhwkooy6quz7z5pkn7b2.png" alt="Whatsapp url preview"/></p>
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xydaba3mn5uvbbcxnz9j.png"/>
<figure><figcaption>Whatsapp and Telegram url previews</figcaption></figure>
<p>In this post, we’ll be building a scraping API with <a href="https://deno.com/">Deno</a> that accepts a URL and retrieves the meta tags for it, so we can get fields like the title, description, image and more from almost any website.</p>
<p>For example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">curl</span><span style="color:#9ECBFF"> https://metatags.deno.dev/api/meta?url=https://dev.to</span></span></code></pre>
<p>will give this result</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;last-updated&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;2024-10-15 15:10:02 UTC&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;user-signed-in&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;false&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;head-cached-at&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;1719685934&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;environment&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;production&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;description&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;A constructive and inclusive social network for software developers. With you every step of your journey.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;keywords&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;software development, engineering, rails, javascript, ruby&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:type&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;website&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:url&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;https://dev.to/&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DEV Community&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:image&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8lvvnvil0m75nw7yi6iz.jpg&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:description&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;A constructive and inclusive social network for software developers. With you every step of your journey.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;og:site_name&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DEV Community&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;twitter:site&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;@thepracticaldev&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;twitter:title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DEV Community&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;twitter:description&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;A constructive and inclusive social network for software developers. With you every step of your journey.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;twitter:image:src&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8lvvnvil0m75nw7yi6iz.jpg&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;twitter:card&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;summary_large_image&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;viewport&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;width=device-width, initial-scale=1.0, viewport-fit=cover&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;apple-mobile-web-app-title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;dev.to&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;application-name&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;dev.to&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;theme-color&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;#000000&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;forem:name&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DEV Community&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;forem:logo&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;https://media.dev.to/cdn-cgi/image/width=512,height=,fit=scale-down,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F8j7kvp660rqzt99zui8e.png&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;forem:domain&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;dev.to&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DEV Community&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>pretty cool, isn’t it?</p>
<h2 id="meta-tags-and-why-do-we-need-them">Meta tags and why do we need them</h2>
<p>Meta tags are HTML elements that are used to provide additional information about a page to search engines and other clients.
These tags typically include a name or property attribute that defines the type of information, and a content attribute that contains the value of that information. Here’s an example of two meta tags:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;description&quot;</span><span style="color:#B392F0"> content</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;The </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">meta&gt; HTML element represents metadata that cannot be represented by other HTML meta-related elements, like </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">base&gt;, </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">link&gt;, </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">script&gt;, </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">style&gt; or </span><span style="color:#FDAEB7;font-style:italic">&lt;</span><span style="color:#9ECBFF">title&gt;.&quot;</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> property</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;og:image&quot;</span><span style="color:#B392F0"> content</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">&quot;https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png&quot;</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<p>The first tag provides a description of the page, while the second is an Open Graph tag that defines an image to display when the page is shared on social media.</p>
<p>One practical application of meta tags is building a bookmark manager. Instead of manually adding the title, description, and image for each bookmark, you can automatically scrape this information from the bookmarked URL using meta tags.</p>
<h2 id="open-graph">Open Graph</h2>
<p>Open Graph is an internet protocol that was originally created by Facebook to standardize the use of metadata within a webpage to represent the content of a page, it helps social networks generate rich link previews.
Read more about it <a href="https://ogp.me/">here</a>.</p>
<h2 id="why-deno">Why Deno?</h2>
<ol>
<li>Deno has secure defaults, meaning it requires explicit permission for file, network, and environment access, reducing the risk of security vulnerabilities.</li>
<li>Deno is built on web standards, uses ES Modules, and aims to use Web Platform APIs (like fetch) over proprietary APIs, making Deno code very similar to the code you’ll write in the browser - but still has some <a href="https://docs.deno.com/runtime/reference/web_platform_apis/#spec-deviations">spec deviation</a> from the browser.</li>
<li>Deno has built-in TypeScript support, allowing you to write TypeScript code without a build step.</li>
<li>Deno comes with a standard library that includes modules for common tasks like HTTP servers, file system operations, and more.</li>
<li>Deno provides a Linter, Formatter and Test runner, allowing you to use the platform instead of relying on third party packages or tools, making it an all-in-one tool for Javascript development.</li>
<li>Deno provides Deno Deploy which is a scalable platform for serverless JavaScript/Typescript applications that are globally distributed, ensuring minimal latency and maximum uptime.</li>
</ol>
<p>The API that we’re building will consist of two parts, a function for fetching and parsing the meta tags, and an API server which will respond to HTTP requests.</p>
<h2 id="getting-the-meta-tags">Getting the meta tags</h2>
<p>Let’s start by going to <a href="https://deno.com/deploy">Deno Deploy</a> and signing in.
After signing in click on “New Playground”
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z13815h0siqyupl2o7n2.png" alt="New Playground Button"/>
This we’ll give us a <code>hello world</code> starting point.
Now we’ll add function that is called <code>getMetaTags</code> that accepts a url and uses the Fetch API to get the HTML of the requested URL and passes it on to a package for HTML parsing (deno-dom).
To add <code>deno-dom</code> to our project we can use the <a href="https://jsr.io/">jsr</a> package manager:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { DOMParser, Element } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;jsr:@b-fuze/deno-dom&quot;</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>Now we’ll use the Fetch API to get the HTML as text:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> headers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Headers</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  headers.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;accept&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;text/html,application/xhtml+xml,application/xml&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> res</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(url, { headers });</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> html</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>After getting the HTML, we can use <code>deno-dom</code> to parse it and then use standard DOM functions like <code>querySelectorAll</code> to get all the <code>meta</code> HTML elements, iterate on them and use <code>getAttribute</code> to get the name, property and content of each one of those tags:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> document</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DOMParser</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">parseFromString</span><span style="color:#E1E4E8">(html, </span><span style="color:#9ECBFF">&quot;text/html&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> metaTags</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;meta&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> documentMeta</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (Array.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(metaTags) </span><span style="color:#F97583">as</span><span style="color:#B392F0"> Element</span><span style="color:#E1E4E8">[])</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">reduce</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">acc</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">meta</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> property</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> meta.</span><span style="color:#B392F0">getAttribute</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;property&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">     ...</span></span></code></pre>
<p>Finally, we’ll also query the <code>&lt;title&gt;</code> element of the page to add it as a field in our API:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">documentMeta.title </span><span style="color:#F97583">??=</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;title&quot;</span><span style="color:#E1E4E8">).textContent;</span></span></code></pre>
<p>It isn’t exactly a meta tag, but I think that it is a useful field, so it’s going to be part of our API anyway. :)</p>
<p>Our final <code>getMetaTags</code> function should look like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { DOMParser, Element } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;jsr:@b-fuze/deno-dom&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> getMetaTags</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">url</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> string</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> headers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Headers</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  headers.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;accept&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;text/html,application/xhtml+xml,application/xml&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> res</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(url, { headers });</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> html</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> document</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DOMParser</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">parseFromString</span><span style="color:#E1E4E8">(html, </span><span style="color:#9ECBFF">&quot;text/html&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> metaTags</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;meta&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> documentMeta</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (Array.</span><span style="color:#B392F0">from</span><span style="color:#E1E4E8">(metaTags) </span><span style="color:#F97583">as</span><span style="color:#B392F0"> Element</span><span style="color:#E1E4E8">[])</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">reduce</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">acc</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">meta</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> property</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> meta.</span><span style="color:#B392F0">getAttribute</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;property&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> name</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> meta.</span><span style="color:#B392F0">getAttribute</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;name&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> content</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> meta.</span><span style="color:#B392F0">getAttribute</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;content&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">content) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> acc;</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (property) acc[property] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> content;</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (name) acc[name] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> content;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#E1E4E8"> acc;</span></span>
<span class="line"><span style="color:#E1E4E8">    }, {} </span><span style="color:#F97583">as</span><span style="color:#B392F0"> Record</span><span style="color:#E1E4E8">&lt;</span><span style="color:#79B8FF">string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">string</span><span style="color:#E1E4E8">&gt;);</span></span>
<span class="line"><span style="color:#E1E4E8">  documentMeta.title </span><span style="color:#F97583">??=</span><span style="color:#E1E4E8"> document.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;title&quot;</span><span style="color:#E1E4E8">).textContent;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> documentMeta;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h2 id="the-server">The server</h2>
<p>For simplicity, I’ve decided to use Deno’s built in http server which is just a simple <code>Deno.serve()</code> call.
Thanks to the fact that deno is built on web standards, we can use the built in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response">Response object in the Fetch API</a> to respond to requests.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">Deno.</span><span style="color:#B392F0">serve</span><span style="color:#E1E4E8">({ port: </span><span style="color:#79B8FF">8000</span><span style="color:#E1E4E8"> }, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">request</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Request</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Promise</span><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">Response</span><span style="color:#E1E4E8">&gt; </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> url</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> URL</span><span style="color:#E1E4E8">(request.url);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (request.method </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &quot;GET&quot;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> url.pathname </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> &quot;/api/meta&quot;</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> metaTags</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getMetaTags</span><span style="color:#E1E4E8">(url.searchParams.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;url&quot;</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> headers</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Headers</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    headers.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Content-Type&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;application/json&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    headers.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Access-Control-Allow-Origin&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;*&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Response</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(metaTags), { status: </span><span style="color:#79B8FF">200</span><span style="color:#E1E4E8">, headers });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Response</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;not found&quot;</span><span style="color:#E1E4E8">, { status: </span><span style="color:#79B8FF">404</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>Our server parses the request url, checks if we received a <code>GET</code> request to the <code>/api/meta</code> path, and calls the <code>getMetaTags</code> function we created and then returns the meta tags as the response body.</p>
<p>We also add two headers, the first is <code>Content-Type</code> that is needed for the client to know the kind of data they’re getting in the response, which in our case is a JSON response.</p>
<p>The second header is <code>Access-Control-Allow-Origin</code> that allows our API to accept requests from specific origins, in our case I chose <code>&quot;*&quot;</code> to accept any origin, but you might want to change it to only accept request from your frontend’s origin.
Note that the CORS headers will only affect requests made by the browser, meaning the browser will block the request according to the origin that is specified in the header, but directly calling the API from a server will still be possible. Read more about CORS <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">here</a>.</p>
<p>You can now click on “Save &amp; Deploy”
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1ifufq6qc5qrlxo6j1vx.png" alt="Save &#38; Deploy Button"/>
Then wait for deno deploy to deploy your code to the playground:
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/35ctvcicseifx3kzb52e.png" alt="Deployment URL"/>
The url on the top right is your playground’s url, copy it and add <code>/api/meta?url=https://dev.to</code> to see it in action, the url should look something like <code>https://metatags.deno.dev/api/meta?url=https://dev.to</code>
You should now see the API responding with <code>dev.to</code>’s meta tags!
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/nd65xc2ugkrtxldecxcy.png" alt="API response"/></p>
<h2 id="deployment">Deployment</h2>
<p>Using Deno deploy’s playground means your code is technically already deployed, it is public and can be accessed by anyone.
For a simple API like the one we’re building, a single file playground can be enough, but in many cases we’d like to scale our project further, for that you can use Deno deploy’s Github export to make a proper code repository for you API, with support for automatic building on new code pushes:
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/co6m4kclieha3czfg38z.png" alt="Github button"/>
or from the playground’s settings:
<img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2yjjagqofxt205fv0e5h.png" alt="Github button from settings"/></p>
<h2 id="caveats">Caveats</h2>
<p>The scraping method presented in this post only works on websites that have meta tags in the html file that’s returned from the server, meaning server rendered or prerendered sites are more likely to return proper results, single page apps can also work as long as the meta tags are set in build time and not in runtime.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We’ve demonstrated how quick and simple it is to build and deploy an API with Deno, we’ve gone over Meta tags, and how we can use the Fetch API, a DOM parser and Deno’s built in server to build a Meta tags scraping API in under 40 lines of code.</p>
<p>To see the project built in this post you can check out the <a href="https://dash.deno.com/playground/metatags">Deno deploy playground</a> (You’ll need to add <code>/api/meta?url=https://dev.to</code> to the url bar on the right to see an example response) or <a href="https://github.com/paripsky/og-scrapi">this github repository</a>.</p> </div> </main> </body></html>